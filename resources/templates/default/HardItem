<% user_auth = instance.__domain__.get_user_auth() 
isstaff = 'anonymous@%s' % instance.__domain__['name'] != user_auth['name']
number = 0
import karacos
import sys, traceback
request = karacos.serving.get_request()
try:
    number = instance.__store__.get_open_cart_for_user()['items'][instance.id]
except:
    pass
if 'description' not in instance:
    instance['description'] = instance['content'][0:120]
    instance.save()
if 'weight' not in instance:
    instance['weight'] = 100
    instance.save()
%>
<aside>
	<nav>
	<% storefolders = instance.__store__._get_store_folders_by_id_()['data'] %>
		<ul id="aside_menu" role="listbox">
			% for folder in storefolders:
				<li role="menuitem"><a href="${instance.__store__._get_action_url()}/${folder['name']}">${folder['label']}</a></li>
			%endfor
		</ul>
	</nav>
</aside>
<div id="StoreContent">
<div class="inside" id="node_menu">
	<ul>
	<li></li>
	</ul>
</div>
<article class="inside"
	id="store_main_container" typeof="karacos:HardItem" 
	about="urn:uuid:${instance.id}" style="float:left"	>
	<div style="display:none;" property="url">${instance._get_action_url()}</div>
	<h1 class="kc_property inside" id="resource_title" property="title">${instance.__get_title__()}</h1>
	<div class="kc_property inside" id="resource_description" property="description">${instance['description']}</div>
	<div class="kc_property inside" id="resource_content" property="content">${instance.__get_content__()}</div>
		<div class=inside" id="item_info">
		% try:
			<div id="item_price">
			Prix : <span property="public_price">${instance['public_price']}</span>
			</div>
			## item_price
			<div id="item_weight"
			% if not isstaff:
				style="display:none;"
			% endif
			>
			Poids : <span property="weight">${instance['weight']}</span>
			</div>
			% if isstaff:
				%if 'stock' not in instance:
            		<% instance['stock'] = 0 %>
            	% endif
			<div id="admin_properties">
				<div>Prix d'achat : <span property="buy_cost">${instance['buy_cost']}</span></div>
				<div>Prix de vente mini : <span property="min_sell_price">${instance['min_sell_price']}</span></div>
				<div>stock : <span property="stock">${instance['stock']}</span></div>
				<div>Taxe : <span property="tax">${instance['tax']}</span></div>
			</div> 
			## admin_properties
			% endif
		% except:
			Error while processing item values	
		% endtry
		</div> 
		## item_info
</article> 
<div class="add_to_cart_panel ui-widget-header ui-corner-all" typeof="karacos:method" about="urn:uuid:${instance.id}:set_number_item">
	    <div style="display:none" property="item_id">${instance.id}</div>
	    <div style="display:none" property="url">${instance.__store__._get_action_url()}</div>
	    <div class="item_cart_control">
	        <div><div class="inc_number" ></div></div>
	        <div class="item_number">Quantit√© au panier : <span  property="number" class="item_cart_number">${number}</span></div>
	        <div><div class="dec_number" ></div></div>
	    </div>
	</div>
</div>
## typeof (HardItem object)

<script language="javascript">
% if 'karacos-fragment' in request.headers or 'Karacos-Fragment' in request.headers:
	KaraCos.config.page_id = '${instance.id}';
	KaraCos.config.page_base_id = '${instance['parent_db']}';
	KaraCos.authManager.authenticationHeader();
%else:
KaraCos(function() {
%endif
		KaraCos('#aside_menu li').click(
			function(event){
				var url = KaraCos.$(this).find('a').attr("href");
				event.stopImmediatePropagation();
				event.preventDefault();
				History.pushState(null, null, url);
				KaraCos.$.ajax({
					url: url,
					headers: {'karacos-fragment': 'true'},
					success: function(data) {
						KaraCos('#MainContent').empty().append(data);
					}
				});
			});
		KaraCos('#aside_menu').menu({});
	
	KaraCos("#store_menu ul li button.save_button").button()
	.click(function(event) {
		event.stopImmediatePropagation();
		event.preventDefault();
		m = VIE.ContainerManager.getInstanceForContainer(KaraCos("#store_main_container"));
		Backbone.sync('_update',m);
	});
	KaraCos.Store.activate_item_cart_buttons();
	KaraCos("#store_menu ul li button.action_button").button()
	.click(function(event) {
		var btn = KaraCos.$(this);
		event.stopImmediatePropagation();
		event.preventDefault();
		KaraCos.action({ url: btn.attr('url'),
				method: btn.attr('method'),
				async: false,
				params: {},
				callback: function(data) {
					if (data.success) {
						KaraCos('[method]').show();
						btn.hide();
					} else {
						alert(data.message);
					}
				}});
	});
KaraCos.Store.init_store({url:'${instance.__store__._get_action_url()}'});
% if 'karacos-fragment' not in request.headers and 'Karacos-Fragment' not in request.headers:
	});
% endif
</script>