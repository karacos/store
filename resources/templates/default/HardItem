<% user_auth = instance.__domain__.get_user_auth() %>
<% isstaff = 'anonymous@%s' % instance.__domain__['name'] != user_auth['name'] %>
<% number = 0 %>
% try:
<% number = instance.__store__.get_open_cart_for_user()['items'][instance.id] %>
% except:

% endtry
<div id="node_menu">
<ul>
% if isstaff:
 <li><button class="save_button">Sauvegarder</button></li>
	<li><button class="action_button" method="publish_node"
	 % if instance._is_sell_open():
 	 	style="display: none;"
 	 % endif
	url="${instance._get_action_url()}">Mettre en vente</button></li>
 	<li><button class="action_button" method="unpublish_node"
 	% if not instance._is_sell_open():
 	 	style="display: none;"
 	 % endif
 	 url="${instance._get_action_url()}">Retirer de la vente</button></li>
% endif
% if 'description' not in instance:
	<% instance['description'] = instance['content'][0:120] %>
	<% instance.save() %>
% endif
% if 'weight' not in instance:
	<% instance['weight'] = 100 %>
	<% instance.save() %>
% endif
<li><div class="add_to_cart_panel" typeof="karacos:method" about="urn:uuid:${instance.id}:set_number_item" url="${instance.__store__._get_action_url()}">
    <div style="display: none" property="item_id">${instance.id}</div>
    <div class="item_cart_control">
        <div><div class="inc_number" ></div></div>
        <div class="item_number">Quantit√© au panier : <span  property="number" class="item_cart_number">${number}</span></div>
        <div><div class="dec_number" ></div></div>
    </div>
</div></li>
</ul>
</div>
<div
% if isstaff:
 id="item_main_container" typeof="karacos:method" 
	about="urn:uuid:${instance.id}:edit_item" url="${instance._get_action_url()}"
% else:
	id="store_main_container" typeof="karacos:HardItem" 
	about="urn:uuid:${instance.id}" url="${instance._get_action_url()}"
% endif
	>
	<h1 id="resource_title" property="title">${instance.__get_title__()}</h1>
	<div id="resource_description" property="description">${instance['description']}</div>
	<div id="resource_content" property="content">${instance.__get_content__()}</div>
		<div id="item_info">
		% try:
			<div id="item_price">
			Prix : <span property="public_price">${instance['public_price']}</span>
			</div>
			## item_price
			<div id="item_weight"
			% if not isstaff:
				style="display:none;"
			% endif
			>
			Poids : <span property="weight">${instance['weight']}</span>
			</div>
			% if isstaff:
				%if 'stock' not in instance:
            		<% instance['stock'] = 0 %>
            	% endif
			<div id="admin_properties">
				<div>Prix d'achat : <span property="buy_cost">${instance['buy_cost']}</span></div>
				<div>Prix de vente mini : <span property="min_sell_price">${instance['min_sell_price']}</span></div>
				<div>stock : <span property="stock">${instance['stock']}</span></div>
				<div>Taxe : <span property="tax">${instance['tax']}</span></div>
			</div> 
			## admin_properties
			% endif
		% except:
			Error while processing item values	
		% endtry
		</div> 
		## item_info
</div> 
## typeof (HardItem object)

<script language="javascript">
KaraCos(function() {
	KaraCos("#store_menu ul li button.save_button").button()
	.click(function(event) {
		event.stopImmediatePropagation();
		event.preventDefault();
		m = VIE.ContainerManager.getInstanceForContainer(KaraCos("#store_main_container"));
		Backbone.sync('_update',m);
	});
	KaraCos.Store.activate_item_cart_buttons();
	KaraCos("#store_menu ul li button.action_button").button()
	.click(function(event) {
		var btn = KaraCos.$(this);
		event.stopImmediatePropagation();
		event.preventDefault();
		KaraCos.action({ url: btn.attr('url'),
				method: btn.attr('method'),
				async: false,
				params: {},
				callback: function(data) {
					if (data.success) {
						KaraCos('[method]').show();
						btn.hide();
					} else {
						alert(data.message);
					}
				}});
	});
KaraCos.Store.init_store({url:'${instance.__store__._get_action_url()}'});
});
</script>